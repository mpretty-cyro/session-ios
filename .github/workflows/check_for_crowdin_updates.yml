name: Check for Crowdin Updates

on:
  push

jobs:
  fetch_convert_and_diff_translations:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo Content
        uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.8
      - name: Download and Convert Translations
        env:
          CROWDIN_API_TOKEN: ${{ secrets.CROWDIN_API_TOKEN }}
        run: |
          python "${{ github.workspace }}/Scripts/download_and_convert_translations.py" \
            "$CROWDIN_API_TOKEN" \
            618696 \
            "${{ github.workspace }}/raw_translations" \
            "${{ github.workspace }}/Session/Meta" \
            "${{ github.workspace }}/Scripts/xliff_to_string_catalog.py" \
            --single-output \
            --skip-untranslated-strings
          rm -rf "${{ github.workspace }}/raw_translations"
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          commit-message: "[Automated] Update translations from Crowdin"
          title: Update translations from Crowdin
          body: This PR includes the latest translations from Crowdin
          branch: feature/update-translations
          delete-branch: true
